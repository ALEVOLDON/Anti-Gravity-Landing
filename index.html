<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anti-Gravity Landing</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Matter.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
            overflow-y: auto;   /* –†–ê–ó–†–ï–®–ê–ï–ú –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
            background-color: #0f172a;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            width: 100vw;
            /* –†–∞–∑—Ä–µ—à–∞–µ–º –∂–µ—Å—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–∫—Ä–æ–ª–ª), –æ—Ç–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∫—Ä–∏–ø—Ç–æ–º */
            touch-action: auto; 
            -webkit-tap-highlight-color: transparent;
        }

        .physics-box {
            position: relative;
            will-change: transform;
            user-select: none;
            z-index: 10;
        }

        .physics-active {
            position: absolute !important;
            top: 0;
            left: 0;
            margin: 0 !important;
            transform-origin: center center;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
        #reset-btn {
            z-index: 9999;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —è–∑—ã–∫–∞ */
        .lang-btn {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.7;
            transition: opacity 0.3s;
            padding: 8px 4px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å –Ω–∞–∂–∞—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            touch-action: manipulation; /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞—á–µ–π */
        }
        .lang-btn:hover, .lang-btn.active {
            opacity: 1;
            text-decoration: underline;
            text-decoration-color: #22d3ee; /* cyan-400 */
        }
    </style>
</head>
<body class="relative">

    <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è) -->
    <button id="reset-btn" class="fixed top-6 right-6 bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-6 rounded-full shadow-2xl border-2 border-red-400 transition transform hover:scale-105 active:scale-95 hidden opacity-0 transition-opacity duration-1000 z-50">
        <span data-key="btn_reset">üîÑ –í–µ—Ä–Ω—É—Ç—å –≤—Å—ë –∫–∞–∫ –±—ã–ª–æ</span>
    </button>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="flex justify-between items-center p-4 md:p-6 w-full max-w-6xl mx-auto physics-box" id="nav-bar">
        <div class="text-xl md:text-2xl font-bold text-cyan-400 tracking-wider border-2 border-cyan-400 p-2 rounded bg-slate-900/50 backdrop-blur">
            GRAVITY.JS
        </div>
        
        <div class="flex items-center gap-4 bg-slate-900/30 p-2 rounded-lg backdrop-blur-sm">
            <!-- –°—Å—ã–ª–∫–∏ (—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ —Å–æ–≤—Å–µ–º –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö, –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ä–µ–¥–Ω–∏—Ö) -->
            <div class="hidden sm:flex space-x-4 border-r border-slate-600 pr-4">
                <a href="#" class="hover:text-cyan-300 transition px-2" data-key="nav_about">–û –Ω–∞—Å</a>
                <a href="#" class="hover:text-cyan-300 transition px-2" data-key="nav_projects">–ü—Ä–æ–µ–∫—Ç—ã</a>
            </div>
            
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ -->
            <div class="flex items-center space-x-1 text-sm md:text-base font-mono">
                <span class="lang-btn active" data-lang="ru">RU</span>
                <span class="text-slate-500">/</span>
                <span class="lang-btn" data-lang="en">EN</span>
            </div>
        </div>
    </nav>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="container mx-auto px-4 pt-4 md:pt-10 flex flex-col items-center text-center h-full justify-start md:justify-center">
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ (text-5xl) -->
        <h1 class="text-5xl sm:text-6xl md:text-8xl font-black mb-4 md:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-purple-500 physics-box leading-tight py-2 md:py-4 drop-shadow-lg" data-key="hero_title">
            –ü–û–¢–ï–†–Ø–ô<br>–ö–û–ù–¢–†–û–õ–¨
        </h1>

        <div class="physics-box mb-8 max-w-2xl bg-slate-800/80 p-4 md:p-6 rounded-xl border border-slate-700 backdrop-blur-md shadow-xl">
            <p class="text-lg md:text-xl text-slate-200" data-key="hero_desc">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–µ–±-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –≥–¥–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞–º –≤–µ—Ä—Å—Ç–∫–∏. 
                –í—Å—ë, —á—Ç–æ –≤—ã –≤–∏–¥–∏—Ç–µ, –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –∑–∞–∫–æ–Ω–∞–º —Ñ–∏–∑–∏–∫–∏.
            </p>
        </div>

        <div class="physics-box mb-8 md:mb-16">
            <button id="start-btn" class="bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-bold py-3 px-8 md:py-4 md:px-12 rounded-full text-lg md:text-xl shadow-[0_0_30px_rgba(34,211,238,0.4)] transition transform hover:scale-105 active:scale-95 cursor-pointer border-4 border-cyan-600/30">
                <span data-key="btn_start">–û–ë–†–£–®–ò–¢–¨ –°–ê–ô–¢ üí•</span>
            </button>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ (–Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º 1 –∫–æ–ª–æ–Ω–∫–∞, –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ 3) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 w-full max-w-6xl px-2 md:px-4 pb-20 md:pb-0">
            <div class="physics-box bg-slate-800 p-6 md:p-8 rounded-2xl border border-slate-700 hover:border-cyan-500 transition shadow-2xl flex flex-col items-center">
                <div class="text-4xl md:text-5xl mb-3 md:mb-4">‚öõÔ∏è</div>
                <h3 class="text-xl md:text-2xl font-bold mb-2 md:mb-3 text-white" data-key="card_phys_title">–§–∏–∑–∏–∫–∞</h3>
                <p class="text-sm md:text-base text-slate-400" data-key="card_phys_desc">–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è. –ë–ª–æ–∫–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è, –æ—Ç—Å–∫–∞–∫–∏–≤–∞—é—Ç –∏ –ª–æ–∂–∞—Ç—Å—è —Ä—É–∏–Ω–∞–º–∏.</p>
            </div>

            <div class="physics-box bg-slate-800 p-6 md:p-8 rounded-2xl border border-slate-700 hover:border-purple-500 transition shadow-2xl flex flex-col items-center">
                <div class="text-4xl md:text-5xl mb-3 md:mb-4">üñêÔ∏è</div>
                <h3 class="text-xl md:text-2xl font-bold mb-2 md:mb-3 text-white" data-key="card_inter_title">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤</h3>
                <p class="text-sm md:text-base text-slate-400" data-key="card_inter_desc">–•–≤–∞—Ç–∞–π –æ–±–ª–æ–º–∫–∏ —Å–∞–π—Ç–∞ –º—ã—à–∫–æ–π! –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π, –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–π –∏ —É—Å—Ç—Ä–∞–∏–≤–∞–π —Ö–∞–æ—Å.</p>
            </div>

            <div class="physics-box bg-slate-800 p-6 md:p-8 rounded-2xl border border-slate-700 hover:border-pink-500 transition shadow-2xl flex flex-col items-center">
                <div class="text-4xl md:text-5xl mb-3 md:mb-4">üèóÔ∏è</div>
                <h3 class="text-xl md:text-2xl font-bold mb-2 md:mb-3 text-white" data-key="card_restore_title">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</h3>
                <p class="text-sm md:text-base text-slate-400" data-key="card_restore_desc">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞, —á—Ç–æ–±—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–Ω–æ–≤–æ.</p>
            </div>
        </div>

    </main>
    
    <!-- –§—É—Ç–µ—Ä -->
    <footer class="fixed bottom-0 w-full p-4 text-center text-slate-500 physics-box bg-slate-900/90 border-t border-slate-800 backdrop-blur-md z-20 text-xs md:text-base">
        <p class="font-semibold" data-key="footer">¬© 2026 Anti-Gravity Experiment. Powered by Matter.js</p>
    </footer>

    <script>
        // --- –ê–£–î–ò–û –î–í–ò–ñ–û–ö (Web Audio API) ---
        const AudioEngine = {
            ctx: null,
            init: function() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            },
            // –ó–≤—É–∫ —É–¥–∞—Ä–∞ (—Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "—Å—Ç—É–∫")
            playBump: function(velocity) {
                if (!this.ctx) return;

                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ 0-20)
                const volume = Math.min(velocity / 15, 1);
                if (volume < 0.1) return; // –°–ª–∏—à–∫–æ–º —Ç–∏—Ö–∏–µ —É–¥–∞—Ä—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º

                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                // –¢—Ä–µ—É–≥–æ–ª—å–Ω–∞—è –≤–æ–ª–Ω–∞ –¥–ª—è –≥–ª—É—Ö–æ–≥–æ —É–¥–∞—Ä–∞
                osc.type = 'triangle';
                
                // –°–ª—É—á–∞–π–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Ç–æ–Ω–∞ –¥–ª—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ (60-100 –ì—Ü)
                const freq = 60 + Math.random() * 40;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                // –ë—ã—Å—Ç—Ä–æ–µ –ø–∞–¥–µ–Ω–∏–µ —Ç–æ–Ω–∞
                osc.frequency.exponentialRampToValueAtTime(10, this.ctx.currentTime + 0.1);

                // –û–≥–∏–±–∞—é—â–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (—Ä–µ–∑–∫–∞—è –∞—Ç–∞–∫–∞, –±—ã—Å—Ç—Ä—ã–π —Å–ø–∞–¥)
                gain.gain.setValueAtTime(volume, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.15);

                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.start();
                osc.stop(this.ctx.currentTime + 0.15);
            },
            // –ó–≤—É–∫ "–í—ã–∫–ª—é—á–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è" (—Å–≤–∏–ø –≤–Ω–∏–∑)
            playPowerDown: function() {
                if (!this.ctx) return;
                
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(800, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, this.ctx.currentTime + 0.5);

                gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.5);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                
                osc.start();
                osc.stop(this.ctx.currentTime + 0.5);
            }
        };

        // --- –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–Ø ---
        const translations = {
            ru: {
                nav_about: "–û –Ω–∞—Å",
                nav_projects: "–ü—Ä–æ–µ–∫—Ç—ã",
                hero_title: "–ü–û–¢–ï–†–Ø–ô<br>–ö–û–ù–¢–†–û–õ–¨",
                hero_desc: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–µ–±-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –≥–¥–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞–º –≤–µ—Ä—Å—Ç–∫–∏. –í—Å—ë, —á—Ç–æ –≤—ã –≤–∏–¥–∏—Ç–µ, –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –∑–∞–∫–æ–Ω–∞–º —Ñ–∏–∑–∏–∫–∏.",
                btn_start: "–û–ë–†–£–®–ò–¢–¨ –°–ê–ô–¢ üí•",
                btn_oops: "–£–ø—Å... üòµ‚Äçüí´",
                btn_reset: "üîÑ –í–µ—Ä–Ω—É—Ç—å –≤—Å—ë –∫–∞–∫ –±—ã–ª–æ",
                card_phys_title: "–§–∏–∑–∏–∫–∞",
                card_phys_desc: "–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è. –ë–ª–æ–∫–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è, –æ—Ç—Å–∫–∞–∫–∏–≤–∞—é—Ç –∏ –ª–æ–∂–∞—Ç—Å—è —Ä—É–∏–Ω–∞–º–∏.",
                card_inter_title: "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤",
                card_inter_desc: "–•–≤–∞—Ç–∞–π –æ–±–ª–æ–º–∫–∏ —Å–∞–π—Ç–∞ –º—ã—à–∫–æ–π (–∏–ª–∏ –ø–∞–ª—å—Ü–µ–º)! –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π, –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–π –∏ —É—Å—Ç—Ä–∞–∏–≤–∞–π —Ö–∞–æ—Å.",
                card_restore_title: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ",
                card_restore_desc: "–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞, —á—Ç–æ–±—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–Ω–æ–≤–æ.",
                footer: "¬© 2026 Anti-Gravity Experiment. Powered by Matter.js"
            },
            en: {
                nav_about: "About",
                nav_projects: "Projects",
                hero_title: "LOSE<br>CONTROL",
                hero_desc: "Welcome to a web space where the interface no longer obeys layout rules. Everything you see obeys the laws of physics.",
                btn_start: "CRASH SITE üí•",
                btn_oops: "Oops... üòµ‚Äçüí´",
                btn_reset: "üîÑ Restore Everything",
                card_phys_title: "Physics",
                card_phys_desc: "Realistic gravity. Blocks collide, bounce, and lie in ruins.",
                card_inter_title: "Interactive",
                card_inter_desc: "Grab site debris with your mouse (or finger)! Drag, toss, and create chaos.",
                card_restore_title: "Restore",
                card_restore_desc: "Click the reset button to instantly rebuild the interface.",
                footer: "¬© 2026 Anti-Gravity Experiment. Powered by Matter.js"
            }
        };

        let currentLang = 'ru';

        function setLanguage(lang) {
            if (isGravityActive) return;

            currentLang = lang;
            
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[lang][key]) {
                    el.innerHTML = translations[lang][key];
                }
            });

            document.querySelectorAll('.lang-btn').forEach(btn => {
                const btnLang = btn.getAttribute('data-lang');
                btn.classList.toggle('active', btnLang === lang);
            });
        }

        // --- –§–ò–ó–ò–ö–ê ---
        const CONFIG = {
            wallThickness: 200,    
            floorOffset: 40,       
            restitution: 0.5,      
            friction: 0.8,         
            buttonDelay: 2500      
        };

        let engine, runner, mouseConstraint;
        let isGravityActive = false;
        let bodiesDomPairs = []; 
        let worldWalls = {}; 
        let lastSoundTime = 0; // –î–ª—è —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–∞ –∑–≤—É–∫–æ–≤

        const initPhysics = () => {
            const { Engine, Runner, Bodies, Composite, Mouse, MouseConstraint, Events, Vector } = Matter;

            engine = Engine.create();
            const world = engine.world;

            const mouse = Mouse.create(document.body);
            mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.1,
                    render: { visible: false }
                }
            });
            
            mouse.element.removeEventListener("mousewheel", mouse.mousewheel);
            mouse.element.removeEventListener("DOMMouseScroll", mouse.mousewheel);

            Composite.add(world, mouseConstraint);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π –¥–ª—è –∑–≤—É–∫–∞
            Events.on(engine, 'collisionStart', (event) => {
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–æ–≤ (–Ω–µ —á–∞—â–µ —Ä–∞–∑ –≤ 50–º—Å)
                const now = Date.now();
                if (now - lastSoundTime < 50) return;

                event.pairs.forEach((pair) => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                    // –í —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Matter.js –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å direct velocity property –Ω–∞ pair,
                    // –ø–æ—ç—Ç–æ–º—É —Å—á–∏—Ç–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –≤–µ–∫—Ç–æ—Ä–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–µ–π
                    const speed = Vector.magnitude(Vector.sub(pair.bodyA.velocity, pair.bodyB.velocity));
                    
                    if (speed > 2) { // –ü–æ—Ä–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è –∑–≤—É–∫–∞
                        AudioEngine.playBump(speed);
                        lastSoundTime = now;
                    }
                });
            });

            Events.on(engine, 'afterUpdate', () => {
                bodiesDomPairs.forEach(({ body, element }) => {
                    const { x, y } = body.position;
                    const angle = body.angle;
                    const w = element.offsetWidth;
                    const h = element.offsetHeight;
                    
                    element.style.transform = `translate(${x - w/2}px, ${y - h/2}px) rotate(${angle}rad)`;
                });
            });

            runner = Runner.create();
            Runner.run(runner, engine);
        };

        const updateWalls = () => {
            const { Bodies, Composite } = Matter;
            const width = window.innerWidth;
            const height = window.innerHeight;
            const t = CONFIG.wallThickness;
            const offset = CONFIG.floorOffset;
            const scrollY = window.scrollY;

            if (worldWalls.ground) {
                Composite.remove(engine.world, [worldWalls.ground, worldWalls.left, worldWalls.right]);
            }

            worldWalls.ground = Bodies.rectangle(width / 2, height + scrollY - offset + t / 2, width * 3, t, { isStatic: true });
            const wallCenterY = (height / 2) + scrollY;
            worldWalls.left = Bodies.rectangle(0 - t / 2, wallCenterY, t, height * 3, { isStatic: true });
            worldWalls.right = Bodies.rectangle(width + t / 2, wallCenterY, t, height * 3, { isStatic: true });

            Composite.add(engine.world, [worldWalls.ground, worldWalls.left, worldWalls.right]);
        };

        const turnOnGravity = () => {
            if (isGravityActive) return;
            isGravityActive = true;

            // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ (–Ω—É–∂–µ–Ω –∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
            AudioEngine.init();
            AudioEngine.playPowerDown();

            document.body.style.overflow = 'hidden';
            document.body.style.touchAction = 'none';

            updateWalls();

            const { Bodies, Composite, Body } = Matter;
            const elements = document.querySelectorAll('.physics-box');
            const scrollY = window.scrollY;

            elements.forEach(el => {
                const rect = el.getBoundingClientRect();
                
                el.style.width = `${rect.width}px`;
                el.style.height = `${rect.height}px`;

                const x = rect.left + rect.width / 2;
                const y = rect.top + scrollY + rect.height / 2;

                const body = Bodies.rectangle(x, y, rect.width, rect.height, {
                    restitution: CONFIG.restitution,
                    friction: CONFIG.friction,
                    density: 0.005
                });

                Body.setAngularVelocity(body, (Math.random() - 0.5) * 0.15);
                Body.setVelocity(body, { x: (Math.random() - 0.5) * 5, y: 0 });

                bodiesDomPairs.push({ body, element: el });
                Composite.add(engine.world, body);

                el.classList.add('physics-active');
            });

            const startBtn = document.getElementById('start-btn').querySelector('span');
            startBtn.innerHTML = translations[currentLang].btn_oops;
            
            const startBtnContainer = document.getElementById('start-btn');
            startBtnContainer.classList.replace('bg-cyan-500', 'bg-pink-600');
            
            const btnPair = bodiesDomPairs.find(p => p.element === startBtnContainer);
            if (btnPair) {
                Body.setVelocity(btnPair.body, { x: 0, y: -10 });
                Body.setAngularVelocity(btnPair.body, 0.2);
            }

            setTimeout(() => {
                const resetBtn = document.getElementById('reset-btn');
                resetBtn.classList.remove('hidden');
                setTimeout(() => resetBtn.classList.remove('opacity-0'), 50);
            }, CONFIG.buttonDelay);
        };

        const resetGravity = () => {
            if (!isGravityActive) return;

            const { Composite } = Matter;
            const bodies = bodiesDomPairs.map(p => p.body);
            Composite.remove(engine.world, bodies);

            bodiesDomPairs.forEach(({ element }) => {
                element.classList.remove('physics-active');
                element.style.transform = '';
                element.style.width = '';
                element.style.height = '';
            });

            bodiesDomPairs = [];
            isGravityActive = false;

            document.body.style.overflow = '';
            document.body.style.touchAction = '';

            const resetBtn = document.getElementById('reset-btn');
            resetBtn.classList.add('opacity-0');
            setTimeout(() => resetBtn.classList.add('hidden'), 500);

            const startBtn = document.getElementById('start-btn').querySelector('span');
            startBtn.innerHTML = translations[currentLang].btn_start;
            
            const startBtnContainer = document.getElementById('start-btn');
            startBtnContainer.classList.replace('bg-pink-600', 'bg-cyan-500');
        };

        window.onload = () => {
            initPhysics();
            
            const startBtn = document.getElementById('start-btn');
            const resetBtn = document.getElementById('reset-btn');
            
            const handleStart = (e) => { 
                if(e.type === 'touchstart') e.preventDefault(); 
                turnOnGravity(); 
            };
            const handleReset = (e) => { 
                if(e.type === 'touchstart') e.preventDefault(); 
                resetGravity(); 
            };

            startBtn.addEventListener('click', handleStart);
            startBtn.addEventListener('touchstart', handleStart);
            
            resetBtn.addEventListener('click', handleReset);
            resetBtn.addEventListener('touchstart', handleReset);

            document.querySelectorAll('.lang-btn').forEach(btn => {
                const lang = btn.getAttribute('data-lang');
                const handleLang = (e) => {
                    if(e.type === 'touchstart') e.preventDefault();
                    setLanguage(lang);
                };
                btn.addEventListener('click', handleLang);
                btn.addEventListener('touchstart', handleLang);
            });
        };

        window.addEventListener('resize', () => {
            if (isGravityActive) {
                updateWalls();
            }
        });

    </script>
</body>
</html>